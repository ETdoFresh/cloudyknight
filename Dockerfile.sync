# Sync service that uploads filtered workspaces to S3
FROM alpine:3.18

# Install required tools
RUN apk add --no-cache \
    aws-cli \
    rsync \
    inotify-tools \
    bash \
    git \
    findutils

# Create working directory
WORKDIR /app

# Copy sync script
COPY scripts/sync-daemon.sh /app/sync-daemon.sh
RUN chmod +x /app/sync-daemon.sh

# Create directories
RUN mkdir -p /local/workspaces /var/lib/sync

# Run sync daemon
CMD ["/app/sync-daemon.sh"]